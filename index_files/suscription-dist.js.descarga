var DOMfunction=function(){if($(".suscriptions--v1").size()>0){$("body").delegate(".js-cancel","click",(function(){const n=$(this).data("id"),t=$(this).data("object");console.log({id:n,object:t}),Swal.fire({title:"¿Estas seguro que deseas cancelar tu suscripción?",text:"Ya no recibirás más este producto",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, cancelar",cancelButtonText:"No, no deseo cancelar"}).then((s=>{if(s.isConfirmed)return $.ajax({url:`https://ccdty9w3f9.execute-api.us-east-1.amazonaws.com/dev/stripe/cancel/${n}`,method:"POST",data:JSON.stringify({object:t}),dataType:"json",contentType:"application/json",success:n=>(setTimeout((()=>{window.location.reload()}),2e3),Swal.fire("Finalizado","La suscripción ha sido cancelada.","success"))})}))}));$("body").delegate(".js-collapse","click",(function(){$(this).toggleClass("active"),$(this).parents(".collapsable").find(".collapsable__contain").stop().slideToggle()}));const n=$("#userId").val();""!==n&&$.ajax({url:`https://ccdty9w3f9.execute-api.us-east-1.amazonaws.com/dev/shopify/${n}/subscription`,method:"GET",success:n=>{if(""!==n&&"Not customer found"!==n.result&&0!==n.subscriptionPlans.length){console.log(n),setTimeout((function(){$(".suscription__loader").addClass("hide"),$(".row--active").removeClass("hide")}),1e3);var t=n.subscriptionPlans;if(t.length){const{paymentMethods:n}=t[0];if(n.length){const t=n.map((n=>{const{brand:t,last4:s}=n;return`<div class="suscription__element">\n                      <p class="suscription__address">${t.toUpperCase()}-xxxx-xxxx-xxxx-${s}</p>\n                      \x3c!-- <a href="#">Editar</a> --\x3e\n                  </div>`})).join(" ");$("#paymentMethods").append(t)}}t.map((n=>{var t=n.image,s=(n.recurrencia,n.subscriptionId),i=s.substr(s.length-5),o=n.productTitle,a=n.variant.option2,e=n.variant.option3,c=n.variant.price,r=n.quantity,d=(n.object,n.formatEndDate);console.log(i);var l=`\n                  <div class="suscription__item" data-id="${i}">\n                      \x3c!-- Item product --\x3e\n                      <div class="suscription__span row">\n                      \n                      <div class="col-md-4">\n                          <figure class="suscription__image">\n                          <img src="${t}">\n                      </figure>\n                      </div>\n                      <div class="suscription__data col-md-8">\n                          <h6>${o}</h6>\n                          <article>\n                          <table>\n                              <tbody>\n                                  <tr>\n                                      <td>\n                                          <p>\n                                          <strong>Precio</strong>\n                                          </p>\n                                      </td>\n                                      <td>\n                                          <p>$${c}</p>\n                                      </td>\n                                  </tr>\n                                  <tr data-table="${a}">\n                                      <td>\n                                          <p>\n                                          <strong>Tamaño</strong>\n                                          </p>\n                                      </td>\n                                      <td>\n                                          <p>${a}</p>\n                                      </td>\n                                  </tr>\n                                  <tr>\n                                      <td>\n                                          <p>\n                                          <strong>Cantidad</strong>\n                                          </p>\n                                      </td>\n                                      <td>\n                                          <p>${r}</p>\n                                      </td>\n                                  </tr>\n                                  <tr data-table="${a}">\n                                      <td>\n                                          <p>\n                                          <strong>Presentación</strong>\n                                          </p>\n                                      </td>\n                                      <td>\n                                          <p>${e}</p>\n                                      </td>\n                                  </tr>\n                                  <tr>\n                                      <td>\n                                          <p>\n                                          <strong>Siguiente cargo</strong>\n                                          </p>\n                                      </td>\n                                      <td>\n                                          <p><strong>${d}</strong></p>\n                                      </td>\n                                  </tr>\n                              </tbody>\n                          </table>\n                          </article>\n                      </div>\n                      </div>\n                  </div>\n              `;$(".suscription__list").append(l)}));var s=(i=n=>n.subscriptionId,[...new Map(t.map((n=>[i(n),n]))).values()]);console.log(s),s.forEach((function(n){console.log(n.subscriptionId);var t=n.subscriptionId,s=t.substr(t.length-5),i=n.recurrencia,o=n.object;console.log(s);var a=`\n                <section class="collapsable" data-contain="${s}">\n                    <div class="suscription__span row collapsable--top js-collapse">\n                      <div class="suscription__id col-12 col-reset">\n                          <h5>No. Suscripción: <span> ${s}</span></h5>\n                          <span class="material-icons-outlined icon">keyboard_arrow_down</span>\n                      </div>\n                      <div class="suscription__time col-12 col-reset">\n                          <p>\n                            <strong>Tipo de recurrencia: ${i.split("-").join(" ")}</strong> <button class="js-cancel pause-suscription" data-id="${t}" data-object="${o}">Cancelar</button>\n                          </p>\n                      </div>\n                      <div class="suscription__counter">\n                          <p class="badge"></p>\n                      </div>\n                    </div>\n                    <div class="collapsable__contain"  data-contain="${s}"></div>\n                  </section>\n              `;$(".suscription__list").append(a),$("[data-id]").each((function(){var n=$(this).data("id");$(this).appendTo('.collapsable__contain[data-contain="'+n+'"]')})),setTimeout((function(){$(".collapsable").each((function(){var n=$(this).find(".suscription__item").size();n>1?$(this).find(".suscription__counter p ").text(n+" Tipos de Productos"):$(this).find(".suscription__counter p ").text(n+" Tipo de Producto")}))}),500)}))}else console.log(n),setTimeout((function(){$(".suscription__loader").addClass("hide"),$(".subscription-link").hide(),$(".row--inactive").removeClass("hide")}),1e3);var i},error:n=>{console.log(n),setTimeout((function(){$(".suscription__loader").addClass("hide"),$(".subscription-link").hide(),$(".row--inactive").removeClass("hide")}),1e3)}})}};$(document).ready(DOMfunction);